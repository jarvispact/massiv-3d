<!doctype html>
<html lang="de">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>vertex-color-cube</title>
        <style type="text/css">
            #container {
                position: fixed;
                top: 0px;
                left: 0px;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }
        </style>
    </head>

    <body>
        <div id="container"></div>
        <script src="massiv-3d.js"></script>
        <script src="assets/cube.js"></script>
        <script type="text/javascript">
            const domNode = document.getElementById('container');

            const { positions, vertexColors, indices } = Cube;
            const geometry = new Geometry({ positions, vertexColors });
            const material = new VertexColorMaterial({ indices });
            const mesh = new Mesh({ geometry, materials: [material] });

            const w = domNode.clientWidth;
            const h = domNode.clientHeight;
            const fov = 45 * Math.PI / 180;
            const aspect = w / h;
            
            const camera = new PerspectiveCamera(fov, aspect, 0.1, 100);
            camera.translate(0, 2, -10);
            camera.lookAt(0, 0, 0);
            camera.computeModelMatrix();

            const scene = new Node();
            scene.addChild(mesh);

            const renderer = new WebGL2Renderer(domNode, scene, camera);
            renderer.init();

            let then = 0;
            let oneSecond = Date.now() + 1000;
            let fps = 0;

            let rotation = 90;

            const tick = (now) => {
                now *= 0.001;
                const delta = now - then;
                then = now;

                fps++;

                const currentTime = Date.now();
                if (currentTime >= oneSecond) {
                    console.log('called ', {fps});
                    fps = 0;
                    oneSecond = currentTime + 1000;
                }

                mesh.rotate(0, rotation * delta, rotation * delta);
                renderer.render();

                requestAnimationFrame(tick);
            };

            requestAnimationFrame(tick);
        </script>
    </body>
</html>